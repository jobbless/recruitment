<?php

// Data functions (insert, update, delete, form) for table Shortlisted_Applicant_Details

// This script and data application were generated by AppGini 5.82
// Download AppGini for free from https://bigprof.com/appgini/download/

function Shortlisted_Applicant_Details_insert() {
	global $Translation;

	// mm: can member insert record?
	$arrPerm = getTablePermissions('Shortlisted_Applicant_Details');
	if(!$arrPerm[1]) return false;

	$data = array();
	$data['Serial_Number'] = $_REQUEST['Serial_Number'];
		if($data['Serial_Number'] == empty_lookup_value) { $data['Serial_Number'] = ''; }
	$data['Shortlist_date'] = intval($_REQUEST['Shortlist_dateYear']) . '-' . intval($_REQUEST['Shortlist_dateMonth']) . '-' . intval($_REQUEST['Shortlist_dateDay']);
	$data['Shortlist_date'] = parseMySQLDate($data['Shortlist_date'], '');
	$data['First_Name'] = $_REQUEST['First_Name'];
		if($data['First_Name'] == empty_lookup_value) { $data['First_Name'] = ''; }
	$data['Middle_Name'] = $_REQUEST['Middle_Name'];
		if($data['Middle_Name'] == empty_lookup_value) { $data['Middle_Name'] = ''; }
	$data['Last_Name'] = $_REQUEST['Last_Name'];
		if($data['Last_Name'] == empty_lookup_value) { $data['Last_Name'] = ''; }
	$data['Level_of_Education'] = $_REQUEST['Level_of_Education'];
		if($data['Level_of_Education'] == empty_lookup_value) { $data['Level_of_Education'] = ''; }
	$data['DOB'] = intval($_REQUEST['DOBYear']) . '-' . intval($_REQUEST['DOBMonth']) . '-' . intval($_REQUEST['DOBDay']);
	$data['DOB'] = parseMySQLDate($data['DOB'], '');
	$data['Age'] = $_REQUEST['Age'];
		if($data['Age'] == empty_lookup_value) { $data['Age'] = ''; }
	$data['District_of_Origin'] = $_REQUEST['District_of_Origin'];
		if($data['District_of_Origin'] == empty_lookup_value) { $data['District_of_Origin'] = ''; }
	$data['Recruitment_centre'] = $_REQUEST['Recruitment_centre'];
		if($data['Recruitment_centre'] == empty_lookup_value) { $data['Recruitment_centre'] = ''; }
	$data['Gender'] = $_REQUEST['Gender'];
		if($data['Gender'] == empty_lookup_value) { $data['Gender'] = ''; }
	$data['Telephone_Contact'] = $_REQUEST['Telephone_Contact'];
		if($data['Telephone_Contact'] == empty_lookup_value) { $data['Telephone_Contact'] = ''; }
	$data['Religion'] = $_REQUEST['Religion'];
		if($data['Religion'] == empty_lookup_value) { $data['Religion'] = ''; }
	$data['Nationality'] = $_REQUEST['Nationality'];
		if($data['Nationality'] == empty_lookup_value) { $data['Nationality'] = ''; }
	$data['NIN'] = $_REQUEST['NIN'];
		if($data['NIN'] == empty_lookup_value) { $data['NIN'] = ''; }
	$data['Tribe'] = $_REQUEST['Tribe'];
		if($data['Tribe'] == empty_lookup_value) { $data['Tribe'] = ''; }
	$data['Special_attribute'] = $_REQUEST['Special_attribute'];
		if($data['Special_attribute'] == empty_lookup_value) { $data['Special_attribute'] = ''; }
	$data['OLevel_School'] = $_REQUEST['OLevel_School'];
		if($data['OLevel_School'] == empty_lookup_value) { $data['OLevel_School'] = ''; }
	$data['English_Grade'] = $_REQUEST['English_Grade'];
		if($data['English_Grade'] == empty_lookup_value) { $data['English_Grade'] = ''; }
	$data['Math_Grade'] = $_REQUEST['Math_Grade'];
		if($data['Math_Grade'] == empty_lookup_value) { $data['Math_Grade'] = ''; }
	$data['Description'] = br2nl($_REQUEST['Description']);
	$data['Total_Mark'] = $_REQUEST['Total_Mark'];
		if($data['Total_Mark'] == empty_lookup_value) { $data['Total_Mark'] = ''; }
	if($data['Serial_Number'] == '') {echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">" . $Translation['error:'] . " 'S/No': " . $Translation['pkfield empty'] . '</div>'; exit;}

	if($data['Nationality'] == '') $data['Nationality'] = "Ugandan";

	// hook: Shortlisted_Applicant_Details_before_insert
	if(function_exists('Shortlisted_Applicant_Details_before_insert')) {
		$args = array();
		if(!Shortlisted_Applicant_Details_before_insert($data, getMemberInfo(), $args)) { return false; }
	}

	$error = '';
	// set empty fields to NULL
	$data = array_map(function($v) { return ($v === '' ? NULL : $v); }, $data);
	insert('Shortlisted_Applicant_Details', backtick_keys_once($data), $error);
	if($error)
		die("{$error}<br><a href=\"#\" onclick=\"history.go(-1);\">{$Translation['< back']}</a>");

	$recID = $data['Serial_Number'];

	// hook: Shortlisted_Applicant_Details_after_insert
	if(function_exists('Shortlisted_Applicant_Details_after_insert')) {
		$res = sql("select * from `Shortlisted_Applicant_Details` where `Serial_Number`='" . makeSafe($recID, false) . "' limit 1", $eo);
		if($row = db_fetch_assoc($res)) {
			$data = array_map('makeSafe', $row);
		}
		$data['selectedID'] = makeSafe($recID, false);
		$args=array();
		if(!Shortlisted_Applicant_Details_after_insert($data, getMemberInfo(), $args)) { return $recID; }
	}

	// mm: save ownership data
	set_record_owner('Shortlisted_Applicant_Details', $recID, getLoggedMemberID());

	// if this record is a copy of another record, copy children if applicable
	if(!empty($_REQUEST['SelectedID'])) Shortlisted_Applicant_Details_copy_children($recID, $_REQUEST['SelectedID']);

	return $recID;
}

function Shortlisted_Applicant_Details_copy_children($destination_id, $source_id) {
	global $Translation;
	$requests = array(); // array of curl handlers for launching insert requests
	$eo = array('silentErrors' => true);
	$uploads_dir = realpath(dirname(__FILE__) . '/../' . $Translation['ImageFolder']);
	$safe_sid = makeSafe($source_id);

	// launch requests, asynchronously
	curl_batch($requests);
}

function Shortlisted_Applicant_Details_delete($selected_id, $AllowDeleteOfParents=false, $skipChecks=false) {
	// insure referential integrity ...
	global $Translation;
	$selected_id=makeSafe($selected_id);

	// mm: can member delete record?
	$arrPerm=getTablePermissions('Shortlisted_Applicant_Details');
	$ownerGroupID=sqlValue("select groupID from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='$selected_id'");
	$ownerMemberID=sqlValue("select lcase(memberID) from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='$selected_id'");
	if(($arrPerm[4]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[4]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[4]==3) { // allow delete?
		// delete allowed, so continue ...
	}else{
		return $Translation['You don\'t have enough permissions to delete this record'];
	}

	// hook: Shortlisted_Applicant_Details_before_delete
	if(function_exists('Shortlisted_Applicant_Details_before_delete')) {
		$args=array();
		if(!Shortlisted_Applicant_Details_before_delete($selected_id, $skipChecks, getMemberInfo(), $args))
			return $Translation['Couldn\'t delete this record'];
	}

	sql("delete from `Shortlisted_Applicant_Details` where `Serial_Number`='$selected_id'", $eo);

	// hook: Shortlisted_Applicant_Details_after_delete
	if(function_exists('Shortlisted_Applicant_Details_after_delete')) {
		$args=array();
		Shortlisted_Applicant_Details_after_delete($selected_id, getMemberInfo(), $args);
	}

	// mm: delete ownership data
	sql("delete from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='$selected_id'", $eo);
}

function Shortlisted_Applicant_Details_update($selected_id) {
	global $Translation;

	// mm: can member edit record?
	$arrPerm=getTablePermissions('Shortlisted_Applicant_Details');
	$ownerGroupID=sqlValue("select groupID from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='".makeSafe($selected_id)."'");
	$ownerMemberID=sqlValue("select lcase(memberID) from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='".makeSafe($selected_id)."'");
	if(($arrPerm[3]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[3]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[3]==3) { // allow update?
		// update allowed, so continue ...
	}else{
		return false;
	}

	$data['Serial_Number'] = makeSafe($_REQUEST['Serial_Number']);
		if($data['Serial_Number'] == empty_lookup_value) { $data['Serial_Number'] = ''; }
	$data['Shortlist_date'] = intval($_REQUEST['Shortlist_dateYear']) . '-' . intval($_REQUEST['Shortlist_dateMonth']) . '-' . intval($_REQUEST['Shortlist_dateDay']);
	$data['Shortlist_date'] = parseMySQLDate($data['Shortlist_date'], '');
	$data['First_Name'] = makeSafe($_REQUEST['First_Name']);
		if($data['First_Name'] == empty_lookup_value) { $data['First_Name'] = ''; }
	$data['Middle_Name'] = makeSafe($_REQUEST['Middle_Name']);
		if($data['Middle_Name'] == empty_lookup_value) { $data['Middle_Name'] = ''; }
	$data['Last_Name'] = makeSafe($_REQUEST['Last_Name']);
		if($data['Last_Name'] == empty_lookup_value) { $data['Last_Name'] = ''; }
	$data['Level_of_Education'] = makeSafe($_REQUEST['Level_of_Education']);
		if($data['Level_of_Education'] == empty_lookup_value) { $data['Level_of_Education'] = ''; }
	$data['DOB'] = intval($_REQUEST['DOBYear']) . '-' . intval($_REQUEST['DOBMonth']) . '-' . intval($_REQUEST['DOBDay']);
	$data['DOB'] = parseMySQLDate($data['DOB'], '');
	$data['Age'] = makeSafe($_REQUEST['Age']);
		if($data['Age'] == empty_lookup_value) { $data['Age'] = ''; }
	$data['District_of_Origin'] = makeSafe($_REQUEST['District_of_Origin']);
		if($data['District_of_Origin'] == empty_lookup_value) { $data['District_of_Origin'] = ''; }
	$data['Recruitment_centre'] = makeSafe($_REQUEST['Recruitment_centre']);
		if($data['Recruitment_centre'] == empty_lookup_value) { $data['Recruitment_centre'] = ''; }
	$data['Gender'] = makeSafe($_REQUEST['Gender']);
		if($data['Gender'] == empty_lookup_value) { $data['Gender'] = ''; }
	$data['Telephone_Contact'] = makeSafe($_REQUEST['Telephone_Contact']);
		if($data['Telephone_Contact'] == empty_lookup_value) { $data['Telephone_Contact'] = ''; }
	$data['Religion'] = makeSafe($_REQUEST['Religion']);
		if($data['Religion'] == empty_lookup_value) { $data['Religion'] = ''; }
	$data['Nationality'] = makeSafe($_REQUEST['Nationality']);
		if($data['Nationality'] == empty_lookup_value) { $data['Nationality'] = ''; }
	$data['NIN'] = makeSafe($_REQUEST['NIN']);
		if($data['NIN'] == empty_lookup_value) { $data['NIN'] = ''; }
	$data['Tribe'] = makeSafe($_REQUEST['Tribe']);
		if($data['Tribe'] == empty_lookup_value) { $data['Tribe'] = ''; }
	$data['Special_attribute'] = makeSafe($_REQUEST['Special_attribute']);
		if($data['Special_attribute'] == empty_lookup_value) { $data['Special_attribute'] = ''; }
	$data['OLevel_School'] = makeSafe($_REQUEST['OLevel_School']);
		if($data['OLevel_School'] == empty_lookup_value) { $data['OLevel_School'] = ''; }
	$data['English_Grade'] = makeSafe($_REQUEST['English_Grade']);
		if($data['English_Grade'] == empty_lookup_value) { $data['English_Grade'] = ''; }
	$data['Math_Grade'] = makeSafe($_REQUEST['Math_Grade']);
		if($data['Math_Grade'] == empty_lookup_value) { $data['Math_Grade'] = ''; }
	$data['Description'] = br2nl(makeSafe($_REQUEST['Description']));
	$data['Total_Mark'] = makeSafe($_REQUEST['Total_Mark']);
		if($data['Total_Mark'] == empty_lookup_value) { $data['Total_Mark'] = ''; }
	$data['selectedID'] = makeSafe($selected_id);

	// hook: Shortlisted_Applicant_Details_before_update
	if(function_exists('Shortlisted_Applicant_Details_before_update')) {
		$args = array();
		if(!Shortlisted_Applicant_Details_before_update($data, getMemberInfo(), $args)) { return false; }
	}

	$o = array('silentErrors' => true);
	sql('update `Shortlisted_Applicant_Details` set       `Serial_Number`=' . (($data['Serial_Number'] !== '' && $data['Serial_Number'] !== NULL) ? "'{$data['Serial_Number']}'" : 'NULL') . ', `Shortlist_date`=' . (($data['Shortlist_date'] !== '' && $data['Shortlist_date'] !== NULL) ? "'{$data['Shortlist_date']}'" : 'NULL') . ', `First_Name`=' . (($data['First_Name'] !== '' && $data['First_Name'] !== NULL) ? "'{$data['First_Name']}'" : 'NULL') . ', `Middle_Name`=' . (($data['Middle_Name'] !== '' && $data['Middle_Name'] !== NULL) ? "'{$data['Middle_Name']}'" : 'NULL') . ', `Last_Name`=' . (($data['Last_Name'] !== '' && $data['Last_Name'] !== NULL) ? "'{$data['Last_Name']}'" : 'NULL') . ', `Level_of_Education`=' . (($data['Level_of_Education'] !== '' && $data['Level_of_Education'] !== NULL) ? "'{$data['Level_of_Education']}'" : 'NULL') . ', `DOB`=' . (($data['DOB'] !== '' && $data['DOB'] !== NULL) ? "'{$data['DOB']}'" : 'NULL') . ', `Age`=' . (($data['Age'] !== '' && $data['Age'] !== NULL) ? "'{$data['Age']}'" : 'NULL') . ', `District_of_Origin`=' . (($data['District_of_Origin'] !== '' && $data['District_of_Origin'] !== NULL) ? "'{$data['District_of_Origin']}'" : 'NULL') . ', `Recruitment_centre`=' . (($data['Recruitment_centre'] !== '' && $data['Recruitment_centre'] !== NULL) ? "'{$data['Recruitment_centre']}'" : 'NULL') . ', `Gender`=' . (($data['Gender'] !== '' && $data['Gender'] !== NULL) ? "'{$data['Gender']}'" : 'NULL') . ', `Telephone_Contact`=' . (($data['Telephone_Contact'] !== '' && $data['Telephone_Contact'] !== NULL) ? "'{$data['Telephone_Contact']}'" : 'NULL') . ', `Religion`=' . (($data['Religion'] !== '' && $data['Religion'] !== NULL) ? "'{$data['Religion']}'" : 'NULL') . ', `Nationality`=' . (($data['Nationality'] !== '' && $data['Nationality'] !== NULL) ? "'{$data['Nationality']}'" : 'NULL') . ', `NIN`=' . (($data['NIN'] !== '' && $data['NIN'] !== NULL) ? "'{$data['NIN']}'" : 'NULL') . ', `Tribe`=' . (($data['Tribe'] !== '' && $data['Tribe'] !== NULL) ? "'{$data['Tribe']}'" : 'NULL') . ', `Special_attribute`=' . (($data['Special_attribute'] !== '' && $data['Special_attribute'] !== NULL) ? "'{$data['Special_attribute']}'" : 'NULL') . ', `OLevel_School`=' . (($data['OLevel_School'] !== '' && $data['OLevel_School'] !== NULL) ? "'{$data['OLevel_School']}'" : 'NULL') . ', `English_Grade`=' . (($data['English_Grade'] !== '' && $data['English_Grade'] !== NULL) ? "'{$data['English_Grade']}'" : 'NULL') . ', `Math_Grade`=' . (($data['Math_Grade'] !== '' && $data['Math_Grade'] !== NULL) ? "'{$data['Math_Grade']}'" : 'NULL') . ', `Description`=' . (($data['Description'] !== '' && $data['Description'] !== NULL) ? "'{$data['Description']}'" : 'NULL') . ', `Total_Mark`=' . (($data['Total_Mark'] !== '' && $data['Total_Mark'] !== NULL) ? "'{$data['Total_Mark']}'" : 'NULL') . " where `Serial_Number`='".makeSafe($selected_id)."'", $o);
	if($o['error']!='') {
		echo $o['error'];
		echo '<a href="Shortlisted_Applicant_Details_view.php?SelectedID='.urlencode($selected_id)."\">{$Translation['< back']}</a>";
		exit;
	}

	$data['selectedID'] = $data['Serial_Number'];

	// hook: Shortlisted_Applicant_Details_after_update
	if(function_exists('Shortlisted_Applicant_Details_after_update')) {
		$res = sql("SELECT * FROM `Shortlisted_Applicant_Details` WHERE `Serial_Number`='{$data['selectedID']}' LIMIT 1", $eo);
		if($row = db_fetch_assoc($res)) {
			$data = array_map('makeSafe', $row);
		}
		$data['selectedID'] = $data['Serial_Number'];
		$args = array();
		if(!Shortlisted_Applicant_Details_after_update($data, getMemberInfo(), $args)) { return; }
	}

	// mm: update ownership data
	sql("update `membership_userrecords` set `dateUpdated`='" . time() . "', `pkValue`='{$data['Serial_Number']}' where `tableName`='Shortlisted_Applicant_Details' and `pkValue`='" . makeSafe($selected_id) . "'", $eo);

}

function Shortlisted_Applicant_Details_form($selected_id = '', $AllowUpdate = 1, $AllowInsert = 1, $AllowDelete = 1, $ShowCancel = 0, $TemplateDV = '', $TemplateDVP = '') {
	// function to return an editable form for a table records
	// and fill it with data of record whose ID is $selected_id. If $selected_id
	// is empty, an empty form is shown, with only an 'Add New'
	// button displayed.

	global $Translation;

	// mm: get table permissions
	$arrPerm=getTablePermissions('Shortlisted_Applicant_Details');
	if(!$arrPerm[1] && $selected_id=='') { return ''; }
	$AllowInsert = ($arrPerm[1] ? true : false);
	// print preview?
	$dvprint = false;
	if($selected_id && $_REQUEST['dvprint_x'] != '') {
		$dvprint = true;
	}


	// populate filterers, starting from children to grand-parents

	// unique random identifier
	$rnd1 = ($dvprint ? rand(1000000, 9999999) : '');
	// combobox: Shortlist_date
	$combo_Shortlist_date = new DateCombo;
	$combo_Shortlist_date->DateFormat = "mdy";
	$combo_Shortlist_date->MinYear = 1900;
	$combo_Shortlist_date->MaxYear = 2100;
	$combo_Shortlist_date->DefaultDate = parseMySQLDate('', '');
	$combo_Shortlist_date->MonthNames = $Translation['month names'];
	$combo_Shortlist_date->NamePrefix = 'Shortlist_date';
	// combobox: Level_of_Education
	$combo_Level_of_Education = new Combo;
	$combo_Level_of_Education->ListType = 0;
	$combo_Level_of_Education->MultipleSeparator = ', ';
	$combo_Level_of_Education->ListBoxHeight = 10;
	$combo_Level_of_Education->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Level_of_Education.csv')) {
		$Level_of_Education_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Level_of_Education.csv')));
		$combo_Level_of_Education->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($Level_of_Education_data)));
		$combo_Level_of_Education->ListData = $combo_Level_of_Education->ListItem;
	}else{
		$combo_Level_of_Education->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("O'Level")));
		$combo_Level_of_Education->ListData = $combo_Level_of_Education->ListItem;
	}
	$combo_Level_of_Education->SelectName = 'Level_of_Education';
	// combobox: DOB
	$combo_DOB = new DateCombo;
	$combo_DOB->DateFormat = "mdy";
	$combo_DOB->MinYear = 1900;
	$combo_DOB->MaxYear = 2100;
	$combo_DOB->DefaultDate = parseMySQLDate('', '');
	$combo_DOB->MonthNames = $Translation['month names'];
	$combo_DOB->NamePrefix = 'DOB';
	// combobox: District_of_Origin
	$combo_District_of_Origin = new Combo;
	$combo_District_of_Origin->ListType = 0;
	$combo_District_of_Origin->MultipleSeparator = ', ';
	$combo_District_of_Origin->ListBoxHeight = 10;
	$combo_District_of_Origin->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.District_of_Origin.csv')) {
		$District_of_Origin_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.District_of_Origin.csv')));
		$combo_District_of_Origin->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($District_of_Origin_data)));
		$combo_District_of_Origin->ListData = $combo_District_of_Origin->ListItem;
	}else{
		$combo_District_of_Origin->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Buikwe;;Bukomansimbi;;Butambala;;Buvuma;;Gomba;;Kalangala;;Kalungu;;Kampala;;Kayunga;;Kiboga;;Kyankwanzi;;Luweero;;Lwengo;;Lyantonde;;Masaka;;Mityana;;Mpigi;;Mubende;;Mukono;;Nakaseke;;Nakasongola;;Rakai;;Sembabule;;Wakiso;;270928;;Budaka;;Bududa;;Bugiri;;Bukedea;;Bukwa;;Bulambuli;;Busia;;Butaleja;;Buyende;;Iganga;;Jinja;;Kaberamaido;;Kaliro;;Kamuli;;Kapchorwa;;Katakwi;;Kibuku;;Kumi;;Kween;;Luuka;;Manafwa;;Mayuge;;Mbale;;Namayingo;;Namutumba;;Ngora;;Pallisa;;Serere;;Sironko;;Soroti;;Tororo;;Abim;;Adjumani;;Agago;;Alebtong;;Amolatar;;Amudat;;Amuru;;Apac;;Arua;;Dokolo;;Gulu;;Kaabong;;Kitgum;;Koboko;;Kole;;Kotido;;Lamwo;;Lira;;Maracha;;Moroto;;Moyo;;Nakapiripirit;;Napak;;Nebbi;;Nwoya;;Otuke;;Oyam;;Pader;;Yumbe;;Zombo;;Buhweju;;Buliisa;;Bundibugyo;;Bushenyi;;Hoima;;Ibanda;;Isingiro;;Kabale;;Kabarole;;Kamwenge;;Kanungu;;Kasese;;Kibaale;;Kiruhura;;Kiryandongo;;Kisoro;;Kyegegwa;;Kyenjojo;;Masindi;;Mbarara;;Mitooma;;Ntoroko;;Ntungamo;;Rubirizi;;Rukungiri;;Sheema;;Kagadi;;Kakumiro;;Omoro;;Rubanda;;Namisindwa;;Pakwach;;Butebo;;Rukiga;;Kyotera;;Bunyangabu;;Nabilatuk;;Bugweri;;Kasanda;;Kwania;;Kapelebyong;;Kibuube;;Obongi;;Kazo;;Rwampara;;Kitagwenda;;Madi-Okollo;;Karenga;;Lusot;;")));
		$combo_District_of_Origin->ListData = $combo_District_of_Origin->ListItem;
	}
	$combo_District_of_Origin->SelectName = 'District_of_Origin';
	// combobox: Recruitment_centre
	$combo_Recruitment_centre = new Combo;
	$combo_Recruitment_centre->ListType = 0;
	$combo_Recruitment_centre->MultipleSeparator = ', ';
	$combo_Recruitment_centre->ListBoxHeight = 10;
	$combo_Recruitment_centre->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Recruitment_centre.csv')) {
		$Recruitment_centre_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Recruitment_centre.csv')));
		$combo_Recruitment_centre->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($Recruitment_centre_data)));
		$combo_Recruitment_centre->ListData = $combo_Recruitment_centre->ListItem;
	}else{
		$combo_Recruitment_centre->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("SOUTHERN;;WESTERN;;CENTRAL ;;EAST CENTRAL ;;EASTERN ;;KAMPALA EXTRA ;;KIGEZI;;MID CENTRAL ;;MID EASTERN ;;MID NORTHERN ;;MID WESTERN;;NORTH EASTERN;;NORTH WESTERN ;;NORTHERN ;;SOUTH EASTERN ;;SOUTH WESTERN ")));
		$combo_Recruitment_centre->ListData = $combo_Recruitment_centre->ListItem;
	}
	$combo_Recruitment_centre->SelectName = 'Recruitment_centre';
	// combobox: Gender
	$combo_Gender = new Combo;
	$combo_Gender->ListType = 0;
	$combo_Gender->MultipleSeparator = ', ';
	$combo_Gender->ListBoxHeight = 10;
	$combo_Gender->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Gender.csv')) {
		$Gender_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Gender.csv')));
		$combo_Gender->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($Gender_data)));
		$combo_Gender->ListData = $combo_Gender->ListItem;
	}else{
		$combo_Gender->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Male;;Female")));
		$combo_Gender->ListData = $combo_Gender->ListItem;
	}
	$combo_Gender->SelectName = 'Gender';
	// combobox: Religion
	$combo_Religion = new Combo;
	$combo_Religion->ListType = 0;
	$combo_Religion->MultipleSeparator = ', ';
	$combo_Religion->ListBoxHeight = 10;
	$combo_Religion->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Religion.csv')) {
		$Religion_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Religion.csv')));
		$combo_Religion->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($Religion_data)));
		$combo_Religion->ListData = $combo_Religion->ListItem;
	}else{
		$combo_Religion->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Anglican;;Budist;;Catholic;;Christian;;Isa Masiya;;Muslem;;Others;;Pagan;;Pentecostal;;Seventh Day Adventist")));
		$combo_Religion->ListData = $combo_Religion->ListItem;
	}
	$combo_Religion->SelectName = 'Religion';
	// combobox: Tribe
	$combo_Tribe = new Combo;
	$combo_Tribe->ListType = 0;
	$combo_Tribe->MultipleSeparator = ', ';
	$combo_Tribe->ListBoxHeight = 10;
	$combo_Tribe->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Tribe.csv')) {
		$Tribe_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Tribe.csv')));
		$combo_Tribe->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($Tribe_data)));
		$combo_Tribe->ListData = $combo_Tribe->ListItem;
	}else{
		$combo_Tribe->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Acholi;;Alur;;Aringa;;Athur;;Bafumbira;;Baganda;;Bagisu;;Bagungu;;Bagwere;;Bahororo;;Bakenyi;;Bakiga;;Bakonzo;;BAMBA;;Banyabindi;;Banyala;;Banyankore;;Banyaruguru;;Banyarwanda;;Banyole;;Banyoro;;Baruuli;;Basoga;;Basongora;;Batagwenda;;Batooro;;Batuku;;Batwa;;Bokora;;Chope;;Dodoth;;Ethur;;Gimara;;Ik (Teuso);;Iteso;;Jie;;Jonam;;Jopadhola;;Kakwa;;Karimojong;;Kebu;;Kumam;;Lango;;Lendu;;Lugbara;;Madi;;Matheniko;;Mvuba;;Napore;;Nubi;;Pian;;Pokot;;Sabiny;;Samia")));
		$combo_Tribe->ListData = $combo_Tribe->ListItem;
	}
	$combo_Tribe->SelectName = 'Tribe';
	// combobox: English_Grade
	$combo_English_Grade = new Combo;
	$combo_English_Grade->ListType = 0;
	$combo_English_Grade->MultipleSeparator = ', ';
	$combo_English_Grade->ListBoxHeight = 10;
	$combo_English_Grade->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.English_Grade.csv')) {
		$English_Grade_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.English_Grade.csv')));
		$combo_English_Grade->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($English_Grade_data)));
		$combo_English_Grade->ListData = $combo_English_Grade->ListItem;
	}else{
		$combo_English_Grade->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("D1;;D2;;C3;;C4;;C5;;C6;;P7;;P8;;F9")));
		$combo_English_Grade->ListData = $combo_English_Grade->ListItem;
	}
	$combo_English_Grade->SelectName = 'English_Grade';
	// combobox: Math_Grade
	$combo_Math_Grade = new Combo;
	$combo_Math_Grade->ListType = 0;
	$combo_Math_Grade->MultipleSeparator = ', ';
	$combo_Math_Grade->ListBoxHeight = 10;
	$combo_Math_Grade->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Math_Grade.csv')) {
		$Math_Grade_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/Shortlisted_Applicant_Details.Math_Grade.csv')));
		$combo_Math_Grade->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($Math_Grade_data)));
		$combo_Math_Grade->ListData = $combo_Math_Grade->ListItem;
	}else{
		$combo_Math_Grade->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("D1;;D2;;C3;;C4;;C5;;C6;;P7;;P8;;F9")));
		$combo_Math_Grade->ListData = $combo_Math_Grade->ListItem;
	}
	$combo_Math_Grade->SelectName = 'Math_Grade';

	if($selected_id) {
		// mm: check member permissions
		if(!$arrPerm[2]) {
			return "";
		}
		// mm: who is the owner?
		$ownerGroupID=sqlValue("select groupID from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='".makeSafe($selected_id)."'");
		$ownerMemberID=sqlValue("select lcase(memberID) from membership_userrecords where tableName='Shortlisted_Applicant_Details' and pkValue='".makeSafe($selected_id)."'");
		if($arrPerm[2]==1 && getLoggedMemberID()!=$ownerMemberID) {
			return "";
		}
		if($arrPerm[2]==2 && getLoggedGroupID()!=$ownerGroupID) {
			return "";
		}

		// can edit?
		if(($arrPerm[3]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[3]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[3]==3) {
			$AllowUpdate=1;
		}else{
			$AllowUpdate=0;
		}

		$res = sql("SELECT * FROM `Shortlisted_Applicant_Details` WHERE `Serial_Number`='" . makeSafe($selected_id) . "'", $eo);
		if(!($row = db_fetch_array($res))) {
			return error_message($Translation['No records found'], 'Shortlisted_Applicant_Details_view.php', false);
		}
		$combo_Shortlist_date->DefaultDate = $row['Shortlist_date'];
		$combo_Level_of_Education->SelectedData = $row['Level_of_Education'];
		$combo_DOB->DefaultDate = $row['DOB'];
		$combo_District_of_Origin->SelectedData = $row['District_of_Origin'];
		$combo_Recruitment_centre->SelectedData = $row['Recruitment_centre'];
		$combo_Gender->SelectedData = $row['Gender'];
		$combo_Religion->SelectedData = $row['Religion'];
		$combo_Tribe->SelectedData = $row['Tribe'];
		$combo_English_Grade->SelectedData = $row['English_Grade'];
		$combo_Math_Grade->SelectedData = $row['Math_Grade'];
		$urow = $row; /* unsanitized data */
		$hc = new CI_Input();
		$row = $hc->xss_clean($row); /* sanitize data */
	} else {
		$combo_Level_of_Education->SelectedText = ( $_REQUEST['FilterField'][1]=='6' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_District_of_Origin->SelectedText = ( $_REQUEST['FilterField'][1]=='9' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_Recruitment_centre->SelectedText = ( $_REQUEST['FilterField'][1]=='10' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_Gender->SelectedText = ( $_REQUEST['FilterField'][1]=='11' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_Religion->SelectedText = ( $_REQUEST['FilterField'][1]=='13' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_Tribe->SelectedText = ( $_REQUEST['FilterField'][1]=='16' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_English_Grade->SelectedText = ( $_REQUEST['FilterField'][1]=='19' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
		$combo_Math_Grade->SelectedText = ( $_REQUEST['FilterField'][1]=='20' && $_REQUEST['FilterOperator'][1]=='<=>' ? (get_magic_quotes_gpc() ? stripslashes($_REQUEST['FilterValue'][1]) : $_REQUEST['FilterValue'][1]) : "");
	}
	$combo_Level_of_Education->Render();
	$combo_District_of_Origin->Render();
	$combo_Recruitment_centre->Render();
	$combo_Gender->Render();
	$combo_Religion->Render();
	$combo_Tribe->Render();
	$combo_English_Grade->Render();
	$combo_Math_Grade->Render();

	// code for template based detail view forms

	// open the detail view template
	if($dvprint) {
		$template_file = is_file("./{$TemplateDVP}") ? "./{$TemplateDVP}" : './templates/Shortlisted_Applicant_Details_templateDVP.html';
		$templateCode = @file_get_contents($template_file);
	}else{
		$template_file = is_file("./{$TemplateDV}") ? "./{$TemplateDV}" : './templates/Shortlisted_Applicant_Details_templateDV.html';
		$templateCode = @file_get_contents($template_file);
	}

	// process form title
	$templateCode = str_replace('<%%DETAIL_VIEW_TITLE%%>', 'MBARARA details', $templateCode);
	$templateCode = str_replace('<%%RND1%%>', $rnd1, $templateCode);
	$templateCode = str_replace('<%%EMBEDDED%%>', ($_REQUEST['Embedded'] ? 'Embedded=1' : ''), $templateCode);
	// process buttons
	if($AllowInsert) {
		if(!$selected_id) $templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-success" id="insert" name="insert_x" value="1" onclick="return Shortlisted_Applicant_Details_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save New'] . '</button>', $templateCode);
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="insert" name="insert_x" value="1" onclick="return Shortlisted_Applicant_Details_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save As Copy'] . '</button>', $templateCode);
	}else{
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '', $templateCode);
	}

	// 'Back' button action
	if($_REQUEST['Embedded']) {
		$backAction = 'AppGini.closeParentModal(); return false;';
	}else{
		$backAction = '$j(\'form\').eq(0).attr(\'novalidate\', \'novalidate\'); document.myform.reset(); return true;';
	}

	if($selected_id) {
		if(!$_REQUEST['Embedded']) $templateCode = str_replace('<%%DVPRINT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="dvprint" name="dvprint_x" value="1" onclick="$j(\'form\').eq(0).prop(\'novalidate\', true); document.myform.reset(); return true;" title="' . html_attr($Translation['Print Preview']) . '"><i class="glyphicon glyphicon-print"></i> ' . $Translation['Print Preview'] . '</button>', $templateCode);
		if($AllowUpdate) {
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '<button type="submit" class="btn btn-success btn-lg" id="update" name="update_x" value="1" onclick="return Shortlisted_Applicant_Details_validateData();" title="' . html_attr($Translation['Save Changes']) . '"><i class="glyphicon glyphicon-ok"></i> ' . $Translation['Save Changes'] . '</button>', $templateCode);
		}else{
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		}
		if(($arrPerm[4]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[4]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[4]==3) { // allow delete?
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '<button type="submit" class="btn btn-danger" id="delete" name="delete_x" value="1" onclick="return confirm(\'' . $Translation['are you sure?'] . '\');" title="' . html_attr($Translation['Delete']) . '"><i class="glyphicon glyphicon-trash"></i> ' . $Translation['Delete'] . '</button>', $templateCode);
		}else{
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		}
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>', $templateCode);
	}else{
		$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', ($ShowCancel ? '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>' : ''), $templateCode);
	}

	// set records to read only if user can't insert new records and can't edit current record
	if(($selected_id && !$AllowUpdate && !$AllowInsert) || (!$selected_id && !$AllowInsert)) {
		$jsReadOnly .= "\tjQuery('#Serial_Number').replaceWith('<div class=\"form-control-static\" id=\"Serial_Number\">' + (jQuery('#Serial_Number').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Shortlist_date').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#Shortlist_dateDay, #Shortlist_dateMonth, #Shortlist_dateYear').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#First_Name').replaceWith('<div class=\"form-control-static\" id=\"First_Name\">' + (jQuery('#First_Name').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Middle_Name').replaceWith('<div class=\"form-control-static\" id=\"Middle_Name\">' + (jQuery('#Middle_Name').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Last_Name').replaceWith('<div class=\"form-control-static\" id=\"Last_Name\">' + (jQuery('#Last_Name').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Level_of_Education').replaceWith('<div class=\"form-control-static\" id=\"Level_of_Education\">' + (jQuery('#Level_of_Education').val() || '') + '</div>'); jQuery('#Level_of_Education-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#DOB').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#DOBDay, #DOBMonth, #DOBYear').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#Age').replaceWith('<div class=\"form-control-static\" id=\"Age\">' + (jQuery('#Age').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#District_of_Origin').replaceWith('<div class=\"form-control-static\" id=\"District_of_Origin\">' + (jQuery('#District_of_Origin').val() || '') + '</div>'); jQuery('#District_of_Origin-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Recruitment_centre').replaceWith('<div class=\"form-control-static\" id=\"Recruitment_centre\">' + (jQuery('#Recruitment_centre').val() || '') + '</div>'); jQuery('#Recruitment_centre-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Gender').replaceWith('<div class=\"form-control-static\" id=\"Gender\">' + (jQuery('#Gender').val() || '') + '</div>'); jQuery('#Gender-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Telephone_Contact').replaceWith('<div class=\"form-control-static\" id=\"Telephone_Contact\">' + (jQuery('#Telephone_Contact').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Religion').replaceWith('<div class=\"form-control-static\" id=\"Religion\">' + (jQuery('#Religion').val() || '') + '</div>'); jQuery('#Religion-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Nationality').replaceWith('<div class=\"form-control-static\" id=\"Nationality\">' + (jQuery('#Nationality').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#NIN').replaceWith('<div class=\"form-control-static\" id=\"NIN\">' + (jQuery('#NIN').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Tribe').replaceWith('<div class=\"form-control-static\" id=\"Tribe\">' + (jQuery('#Tribe').val() || '') + '</div>'); jQuery('#Tribe-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Special_attribute').replaceWith('<div class=\"form-control-static\" id=\"Special_attribute\">' + (jQuery('#Special_attribute').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#OLevel_School').replaceWith('<div class=\"form-control-static\" id=\"OLevel_School\">' + (jQuery('#OLevel_School').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#English_Grade').replaceWith('<div class=\"form-control-static\" id=\"English_Grade\">' + (jQuery('#English_Grade').val() || '') + '</div>'); jQuery('#English_Grade-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Math_Grade').replaceWith('<div class=\"form-control-static\" id=\"Math_Grade\">' + (jQuery('#Math_Grade').val() || '') + '</div>'); jQuery('#Math_Grade-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#Description').replaceWith('<div class=\"form-control-static\" id=\"Description\">' + (jQuery('#Description').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Total_Mark').replaceWith('<div class=\"form-control-static\" id=\"Total_Mark\">' + (jQuery('#Total_Mark').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('.select2-container').hide();\n";

		$noUploads = true;
	}elseif($AllowInsert) {
		$jsEditable .= "\tjQuery('form').eq(0).data('already_changed', true);"; // temporarily disable form change handler
			$jsEditable .= "\tjQuery('form').eq(0).data('already_changed', false);"; // re-enable form change handler
	}

	// process combos
	$templateCode = str_replace('<%%COMBO(Shortlist_date)%%>', ($selected_id && !$arrPerm[3] ? '<div class="form-control-static">' . $combo_Shortlist_date->GetHTML(true) . '</div>' : $combo_Shortlist_date->GetHTML()), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Shortlist_date)%%>', $combo_Shortlist_date->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(Level_of_Education)%%>', $combo_Level_of_Education->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Level_of_Education)%%>', $combo_Level_of_Education->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(DOB)%%>', ($selected_id && !$arrPerm[3] ? '<div class="form-control-static">' . $combo_DOB->GetHTML(true) . '</div>' : $combo_DOB->GetHTML()), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(DOB)%%>', $combo_DOB->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(District_of_Origin)%%>', $combo_District_of_Origin->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(District_of_Origin)%%>', $combo_District_of_Origin->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(Recruitment_centre)%%>', $combo_Recruitment_centre->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Recruitment_centre)%%>', $combo_Recruitment_centre->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(Gender)%%>', $combo_Gender->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Gender)%%>', $combo_Gender->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(Religion)%%>', $combo_Religion->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Religion)%%>', $combo_Religion->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(Tribe)%%>', $combo_Tribe->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Tribe)%%>', $combo_Tribe->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(English_Grade)%%>', $combo_English_Grade->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(English_Grade)%%>', $combo_English_Grade->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(Math_Grade)%%>', $combo_Math_Grade->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(Math_Grade)%%>', $combo_Math_Grade->SelectedData, $templateCode);

	/* lookup fields array: 'lookup field name' => array('parent table name', 'lookup field caption') */
	$lookup_fields = array();
	foreach($lookup_fields as $luf => $ptfc) {
		$pt_perm = getTablePermissions($ptfc[0]);

		// process foreign key links
		if($pt_perm['view'] || $pt_perm['edit']) {
			$templateCode = str_replace("<%%PLINK({$luf})%%>", '<button type="button" class="btn btn-default view_parent hspacer-md" id="' . $ptfc[0] . '_view_parent" title="' . html_attr($Translation['View'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-eye-open"></i></button>', $templateCode);
		}

		// if user has insert permission to parent table of a lookup field, put an add new button
		if($pt_perm['insert'] && !$_REQUEST['Embedded']) {
			$templateCode = str_replace("<%%ADDNEW({$ptfc[0]})%%>", '<button type="button" class="btn btn-success add_new_parent hspacer-md" id="' . $ptfc[0] . '_add_new" title="' . html_attr($Translation['Add New'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-plus-sign"></i></button>', $templateCode);
		}
	}

	// process images
	$templateCode = str_replace('<%%UPLOADFILE(Serial_Number)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Shortlist_date)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(First_Name)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Middle_Name)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Last_Name)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Level_of_Education)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(DOB)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Age)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(District_of_Origin)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Recruitment_centre)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Gender)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Telephone_Contact)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Religion)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Nationality)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(NIN)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Tribe)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Special_attribute)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(OLevel_School)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(English_Grade)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Math_Grade)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Description)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Total_Mark)%%>', '', $templateCode);

	// process values
	if($selected_id) {
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Serial_Number)%%>', safe_html($urow['Serial_Number']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Serial_Number)%%>', html_attr($row['Serial_Number']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Serial_Number)%%>', urlencode($urow['Serial_Number']), $templateCode);
		$templateCode = str_replace('<%%VALUE(Shortlist_date)%%>', @date('m/d/Y', @strtotime(html_attr($row['Shortlist_date']))), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Shortlist_date)%%>', urlencode(@date('m/d/Y', @strtotime(html_attr($urow['Shortlist_date'])))), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(First_Name)%%>', safe_html($urow['First_Name']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(First_Name)%%>', html_attr($row['First_Name']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(First_Name)%%>', urlencode($urow['First_Name']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Middle_Name)%%>', safe_html($urow['Middle_Name']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Middle_Name)%%>', html_attr($row['Middle_Name']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Middle_Name)%%>', urlencode($urow['Middle_Name']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Last_Name)%%>', safe_html($urow['Last_Name']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Last_Name)%%>', html_attr($row['Last_Name']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Last_Name)%%>', urlencode($urow['Last_Name']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Level_of_Education)%%>', safe_html($urow['Level_of_Education']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Level_of_Education)%%>', html_attr($row['Level_of_Education']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Level_of_Education)%%>', urlencode($urow['Level_of_Education']), $templateCode);
		$templateCode = str_replace('<%%VALUE(DOB)%%>', @date('m/d/Y', @strtotime(html_attr($row['DOB']))), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(DOB)%%>', urlencode(@date('m/d/Y', @strtotime(html_attr($urow['DOB'])))), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Age)%%>', safe_html($urow['Age']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Age)%%>', html_attr($row['Age']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Age)%%>', urlencode($urow['Age']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(District_of_Origin)%%>', safe_html($urow['District_of_Origin']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(District_of_Origin)%%>', html_attr($row['District_of_Origin']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(District_of_Origin)%%>', urlencode($urow['District_of_Origin']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Recruitment_centre)%%>', safe_html($urow['Recruitment_centre']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Recruitment_centre)%%>', html_attr($row['Recruitment_centre']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Recruitment_centre)%%>', urlencode($urow['Recruitment_centre']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Gender)%%>', safe_html($urow['Gender']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Gender)%%>', html_attr($row['Gender']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Gender)%%>', urlencode($urow['Gender']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Telephone_Contact)%%>', safe_html($urow['Telephone_Contact']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Telephone_Contact)%%>', html_attr($row['Telephone_Contact']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Telephone_Contact)%%>', urlencode($urow['Telephone_Contact']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Religion)%%>', safe_html($urow['Religion']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Religion)%%>', html_attr($row['Religion']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Religion)%%>', urlencode($urow['Religion']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Nationality)%%>', safe_html($urow['Nationality']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Nationality)%%>', html_attr($row['Nationality']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Nationality)%%>', urlencode($urow['Nationality']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(NIN)%%>', safe_html($urow['NIN']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(NIN)%%>', html_attr($row['NIN']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(NIN)%%>', urlencode($urow['NIN']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Tribe)%%>', safe_html($urow['Tribe']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Tribe)%%>', html_attr($row['Tribe']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Tribe)%%>', urlencode($urow['Tribe']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Special_attribute)%%>', safe_html($urow['Special_attribute']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Special_attribute)%%>', html_attr($row['Special_attribute']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Special_attribute)%%>', urlencode($urow['Special_attribute']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(OLevel_School)%%>', safe_html($urow['OLevel_School']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(OLevel_School)%%>', html_attr($row['OLevel_School']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(OLevel_School)%%>', urlencode($urow['OLevel_School']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(English_Grade)%%>', safe_html($urow['English_Grade']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(English_Grade)%%>', html_attr($row['English_Grade']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(English_Grade)%%>', urlencode($urow['English_Grade']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Math_Grade)%%>', safe_html($urow['Math_Grade']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Math_Grade)%%>', html_attr($row['Math_Grade']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Math_Grade)%%>', urlencode($urow['Math_Grade']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(Description)%%>', safe_html($urow['Description']), $templateCode);
		}else{
			$templateCode = str_replace('<%%VALUE(Description)%%>', html_attr($row['Description']), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(Description)%%>', urlencode($urow['Description']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Total_Mark)%%>', safe_html($urow['Total_Mark']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Total_Mark)%%>', html_attr($row['Total_Mark']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Total_Mark)%%>', urlencode($urow['Total_Mark']), $templateCode);
	}else{
		$templateCode = str_replace('<%%VALUE(Serial_Number)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Serial_Number)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Shortlist_date)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Shortlist_date)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(First_Name)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(First_Name)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Middle_Name)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Middle_Name)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Last_Name)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Last_Name)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Level_of_Education)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Level_of_Education)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(DOB)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(DOB)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Age)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Age)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(District_of_Origin)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(District_of_Origin)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Recruitment_centre)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Recruitment_centre)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Gender)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Gender)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Telephone_Contact)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Telephone_Contact)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Religion)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Religion)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Nationality)%%>', 'Ugandan', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Nationality)%%>', urlencode('Ugandan'), $templateCode);
		$templateCode = str_replace('<%%VALUE(NIN)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(NIN)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Tribe)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Tribe)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Special_attribute)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Special_attribute)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(OLevel_School)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(OLevel_School)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(English_Grade)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(English_Grade)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Math_Grade)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Math_Grade)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Description)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Description)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Total_Mark)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Total_Mark)%%>', urlencode(''), $templateCode);
	}

	// process translations
	foreach($Translation as $symbol=>$trans) {
		$templateCode = str_replace("<%%TRANSLATION($symbol)%%>", $trans, $templateCode);
	}

	// clear scrap
	$templateCode = str_replace('<%%', '<!-- ', $templateCode);
	$templateCode = str_replace('%%>', ' -->', $templateCode);

	// hide links to inaccessible tables
	if($_REQUEST['dvprint_x'] == '') {
		$templateCode .= "\n\n<script>\$j(function() {\n";
		$arrTables = getTableList();
		foreach($arrTables as $name => $caption) {
			$templateCode .= "\t\$j('#{$name}_link').removeClass('hidden');\n";
			$templateCode .= "\t\$j('#xs_{$name}_link').removeClass('hidden');\n";
		}

		$templateCode .= $jsReadOnly;
		$templateCode .= $jsEditable;

		if(!$selected_id) {
		}

		$templateCode.="\n});</script>\n";
	}

	// ajaxed auto-fill fields
	$templateCode .= '<script>';
	$templateCode .= '$j(function() {';


	$templateCode.="});";
	$templateCode.="</script>";
	$templateCode .= $lookups;

	// handle enforced parent values for read-only lookup fields

	// don't include blank images in lightbox gallery
	$templateCode = preg_replace('/blank.gif" data-lightbox=".*?"/', 'blank.gif"', $templateCode);

	// don't display empty email links
	$templateCode=preg_replace('/<a .*?href="mailto:".*?<\/a>/', '', $templateCode);

	/* default field values */
	$rdata = $jdata = get_defaults('Shortlisted_Applicant_Details');
	if($selected_id) {
		$jdata = get_joined_record('Shortlisted_Applicant_Details', $selected_id);
		if($jdata === false) $jdata = get_defaults('Shortlisted_Applicant_Details');
		$rdata = $row;
	}
	$templateCode .= loadView('Shortlisted_Applicant_Details-ajax-cache', array('rdata' => $rdata, 'jdata' => $jdata));

	// hook: Shortlisted_Applicant_Details_dv
	if(function_exists('Shortlisted_Applicant_Details_dv')) {
		$args=array();
		Shortlisted_Applicant_Details_dv(($selected_id ? $selected_id : FALSE), getMemberInfo(), $templateCode, $args);
	}

	return $templateCode;
}
?>